#!/usr/bin/env python
"""
	@author: Jean-Lou Dupont
"""

import os
import sys

this_version = "$version"

command = sys.argv[1]
version = sys.argv[2]
cwd     = os.getcwd()
id      = "$Id$"

print "LITM: cwd[%s] id[%s]" % (cwd, id)
print "LITM: postinst: command[%s] configured version [%s] this version[%s]" % (command, version, this_version)


if command == 'configure':

	#configured version
	cv  = '/usr/lib/liblitm-%s.so' % version
	cvd = '/usr/lib/liblitm_debug-%s.so' % version

	dst = '/usr/lib/liblitm.so'
	src = '/usr/lib/liblitm-%s.so' % this_version
	
	ddst = '/usr/lib/liblitm_debug.so'
	dsrc = '/usr/lib/liblitm_debug-%s.so' % this_version
	
	code = 0
	try:
		print """LITM: removing previous symlinks"""
		os.remove(dst)
		os.remove(ddst)
	except:
		pass
	
	try:
		print """LITM: creating symlink src[%s] ==> dst[%s]""" % (src, dst)
		os.symlink(src,  dst)
	except Exception,e:
		print "Exception [%s]" % e
		code = 1
		
	try:
		print """LITM: creating symlink src[%s] ==> dst[%s]""" % (dsrc, ddst)
		os.symlink(dsrc, ddst)	
	except Exception,e:
		print "Exception [%s]" % e
		code = 1
		
	try:
		print """LITM: chmod's"""
		os.chmod(src, 0755)
		os.chmod(dst, 0755)
		os.chmod(dsrc, 0755)
		os.chmod(ddst, 0755)
	except Exception,e:
		print "Exception [%s]" % e
		code = 1
	
	os.system("ldconfig")
	sys.exit( code )
	
